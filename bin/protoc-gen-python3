#!/usr/bin/env python3

import sys
from protobuf3.compiler.plugin_api import CodeGeneratorResponse, CodeGeneratorRequest
from protobuf3.compiler import Compiler

data = sys.stdin.buffer.read()
# data = b'\n\ntest.protoz\xa7\x01\n\ntest.proto"\x15\n\x05TestA\x12\x0c\n\x01a\x18\x01 \x01(\x05:\x011J\x81\x01\n\x06\x12\x04\x00\x00\x02\t\n\n\n\x02\x04\x00\x12\x04\x00\x00\x02\t\n\n\n\x03\x04\x00\x01\x12\x03\x00\x08\r\n\x0b\n\x04\x04\x00\x02\x00\x12\x03\x01\x0c/\n\x0c\n\x05\x04\x00\x02\x00\x04\x12\x03\x01\x0c\x14\n\x0c\n\x05\x04\x00\x02\x00\x05\x12\x03\x01\x15\x1a\n\x0c\n\x05\x04\x00\x02\x00\x01\x12\x03\x01\x1b\x1c\n\x0c\n\x05\x04\x00\x02\x00\x03\x12\x03\x01\x1f \n\x0c\n\x05\x04\x00\x02\x00\x08\x12\x03\x01!.\n\x0c\n\x05\x04\x00\x02\x00\x07\x12\x03\x01,-'
msg = CodeGeneratorRequest()
msg.parse_from_bytes(data)

response = CodeGeneratorResponse()

for fdesc in msg.proto_file:
    if fdesc.name in msg.file_to_generate:
        compiler = Compiler(fdesc)

        file = CodeGeneratorResponse.File()
        file.name = compiler.return_file_name()
        file.content = compiler.return_file_contents()

        response.file.append(file)

sys.stdout.buffer.write(response.encode_to_bytes())
